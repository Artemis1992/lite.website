## Использование тега URL для формирование маршрутов к URL-схемам

**На данный момент поняли как создавать шаблоны и прописывать в них различные теги ```{% имя тега %}```, ```{{ Имя_переменной }}```, ```{{value|имя_файла}}```. Курс по данной тематики [Jinja2 шаблонизатор](https://youtu.be/cFJqMXxVNsI?si=HIb0BefdjzhvOCM9)**

**Следующим важным шагом это научится правильно указывать URL-адреса**

**Мы во всех ссылках прописывали такую загрушку символ "#". Пришло время сформировать полноценные ссылки на страницы. Для этого в джанго используют специальный тег URL ```{% url'<URL-адрес или имя маршрута>'[параметры ссылки]%}```, за которым идет адрес или имя маршрута и так же необязательный параметр ссылки. Т.е. если у ссылки есть какие то параметры мы можем их указать в[параметры ссылки].**

**Сейчас пропишем с помощью тега URl маршрут к главнй странице. Для этого переходим в проект наш и откроем файл шаблона ```base.html``` и видем что ссылка в нашем шаблоне прописана так "#"**
```
        <div class="header">
            <ul id="mainmenu" class="mainmenu">
                <!-- Логотип -->
    ---->       <li class="logo"><a href="#"><div class="logo"></div></a></li>
                
                <!-- Цикл по элементам меню -->
```
**Если мы хотим указать тут "#" ссылку на главную страницу, мы можем поступить разными способами для примера запишем вместо шарпа просто слеш "/"**
```
    ---->       <li class="logo"><a href="/"><div class="logo"></div></a></li>
```
**перейдем на сайт и нажмем на эмблему сайта и действительно мы перешли на главную страницу**

**Однако прописывать ссылки таким образом не лучший путь, потому что URL главной страницы не обязательно должен совподать с доменным именем. Если вдруг он изменится то везде в шаблонах нужно вносить соответсующие изменения. Гораздо практичнее и чаще всего так делают, используют имена маршрутов.**

**Если мы откроем файл ```urls.py```, то увидим имена двух маршрутов ```home```, ```about```.**
```
urlpatterns = [
    path('', index, name='home'),
    path('about/', about, name='about'),

]
```
**Сейчас нас интересует маршрут ```home```, Сейчас воспользуемся этим именем ```name='home'``` для того чтобы прописать этот маршрут ```('',``` на главную страницу, но прописывать будем в шаблоне ```base.html```, там где у нас прописан был маршрут так "/". Как раз для этого мы воспользуемся тегом url ```{% url "home" %}```**
```
        <div class="header">
            <ul id="mainmenu" class="mainmenu">
                <!-- Логотип -->
                <li class="logo"><a href="{% url "home" %}"><div class="logo"></div></a></li>
                
                <!-- Цикл по элементам меню -->
```
**Теперь переходим на главную страницу и жмем на эмблему сайта и действительно наша ссылка формируется на главную страницу.  Но если по каким то причинам главная страница в маршрутах в файле ```urls.py``` изменится допустим так   ```path('home/', index, name='home')```, переходиим в браузер и обновляем нашу страницу и соответсвенно увидем Page not found. Теперь пропишем ссылку в адресной страке http://127.0.0.1:8000/home/ и теперь нажме на эмблему сайта и действительно будем переходить на главную страницу. Как видем такой подход с использованием имен гораздо удобне. И если что то изменится в маршрутах то в шаблоне ```base.html```**
```
    <!-- Блок главного меню -->
    {% block mainmenu %}
        <div class="header">
            <ul id="mainmenu" class="mainmenu">
                <!-- Логотип -->
                <li class="logo"><a href="{% url "home" %}"><div class="logo"></div></a></li>
                

```
**Ничего менять не надо. Все изменения пременятся автоматически. Но пока что мы вернем все как и было в файле ```urls.py``` в строке сделаем так```path('', index, name='home')```**

## *Создание страниц и ссылок для пунктов меню хедера*
**Для этого в проекте в файле ```views.py``` там где формируется главное меню мы его определим другим списком - Список из словарей**
```
menu = [{"title": "О сайте", "url_name": "about"},
        {"title": "Добавить статью", "url_name": "add_page"},
        {"title": "Обратная связь", "url_name": "contact"},
        {"title": "Войти", "url_name": "login"},
]
```
**Этот список содержит несколько словарей, каждый из которых представляет собой пункт меню для веб-сайта. Каждый словарь имеет два ключа:**

1. **```title``` — название пункта меню, которое будет отображаться на сайте. Это заголовок ссылки, видимый пользователям.**

2. **```url_name``` — имя маршрута (URL), который связан с соответствующим пунктом меню. Это путь или имя маршрута в приложении, куда ведет ссылка.**

**Но пока что у нас нет маршрутов таких в файле ```urls.p```. Так как есть у нас ```about``` маршрут, добавим к нему еще три.**
```
urlpatterns = [
    path('', index, name='home'),  # Главная страница
    path('about/', about, name='about'),  # Страница "О сайте"
    path('addpage/', addpage, name='add_page'),  # Добавление статьи
    path('contact/', contact, name='contact'),  # Обратная связь
    path('login/', login, name='login')  # Страница входа
]
```
**Теперь нам нужно прописать 3 функции предстовления. Мы их сделаем пока просто в виде функций заглушек. Перейдем в файл ```views.py```, и вместо функций этих что ниже, пропишем другие.**
```
def categories(request, catid):
    if(request.GET):
        print(request.GET)  # Выводим параметры в терминал
    return HttpResponse(f"<h1>Статьи по категориям</h1><p>{catid}</p>")

def archive(request, year):
    # Если год больше 2024, выполняем редирект на главную страницу
    if int(year) > 2024:
        return redirect('home', permanent=True) # Редирект
    # Возвращаем HttpResponse с заголовком и значением года
    return HttpResponse(f"<h1>Архив по годам</h1><p>{year}</p>")
```
**Запишем следующие функции**
```
def addpage(request):
    return HttpResponse("Добавление статьи")

def contact(request):
    return HttpResponse("Обратная сязь")

def login(request):
    return HttpResponse("Авторизация")
```
**Теперь все функции из файла из ```views.py```, определены в фале ```urls.py```. Так же видоизменим функцию ```index```. Мы возвращаем в нашу функцию index  множество разных параметров, это не очень хорошо выглядит визуально. Потому что нам нужно делать скроллинг делать и смотреть что там написанно у нас за пределами экрана. Поэтому в таких случаях поступают следующим образом - создают специальный словарь с любым названием, главное что это словарь. И всловаре у нас перечисленны все пораметры которые мы тут передаем. А всамой функции рендер вместо вот списка словоря, Мы указываем специальный именнованный параметр context и ему присваеваем ссылку на словарь context и получается у нас так context=context**
```
def index(request):
    posts = People.objects.all()
    context = {
        'posts': posts,
        'menu': menu,
        'title': 'Главная страница',
    }
    return render(request, 'people/index.html', context=context)
```
**Теперь визуально гораздо лучше воспринисается то что тут написанно.**

**Теперь нам осталось это видоизмененное меню прописать в ```base.html``` в блоке где отображается главное меню.**
```
    <!-- Блок главного меню -->
    {% block mainmenu %}
        <div class="header">
            <ul id="mainmenu" class="mainmenu">
                <!-- Логотип -->
                <li class="logo"><a href="{% url "home" %}"><div class="logo"></div></a></li>
                
                <!-- Цикл по элементам меню -->
                {% for m in menu %}
                    {% if not forloop.last %}
                        <li><a href="#">{{m.title}}</a></li>
                    {% else %}
                        <li class="last"><a href="#">{{m.title}}</a></li>
                    {% endif %}
                {% endfor %}

```
**И нам осталось прописать эти маршруты "#" и это сделаем с помощью того же тега url ```{% url m.url_name %}```**

* Пример
```
...
                    {% else %}
                        <li class="last"><a href="#">{{m.title}}</a></li>
                    {% endif %}
...
```
**Имя маршрута возьмем из коллекции меню в фале ```views.py```. У нас m это колекция словаря-списка и на каждой итерации мы берем имя url_name. И соответсвенно этот url_name его значения about, add_page, contact, login, .**
```
menu = [{"title": "О сайте", "url_name": "about"},
        {"title": "Добавить статью", "url_name": "add_page"},
        {"title": "Обратная связь", "url_name": "contact"},
        {"title": "Войти", "url_name": "login"},
]
```
**Они все будут фигурировать в нашем теге m.url_name в нашем файле ```base.html``` и подстовлятся сюда же. И потом это имя будет братся из фала ```urls.py```, из нашей коллекции и подстовлятся вместо имени конкретный маршрут**
```
urlpatterns = [
    path('', index, name='home'),  # Главная страница
    path('about/', about, name='about'),  # Страница "О сайте"
    path('addpage/', addpage, name='add_page'),  # Добавление статьи
    path('contact/', contact, name='contact'),  # Обратная связь
    path('login/', login, name='login')  # Авторизация
]
```
**И тоже самое сделаем и тут**
```
                <!-- Цикл по элементам меню -->
                {% for m in menu %}
                    {% if not forloop.last %}
                        <li><a href="{% url m.url_name %}">{{m.title}}</a></li>
                    {% else %}
```
**ТАким образом мы прописали маршруты для нашего главного меню**

**ТЕперь можно перейти на нашу страницу и проверим как работает наше меню. теперь когда запускаем разделы у нас запускаются соответсвующие маршруты.**

**```О сайте```  - ```about```**

**```Добавить статью``` - ```add_page```**

**```Обратная связь``` - ```contact```**

**```Авторизация``` - ```login```**

**Осталось прописать ссылки у наших статей. И где прочитать пост у нас тоже  стоят заглушки. На них тоже надо сформировать полнценные ссылки.**

**Открываем файл urls.py тут пропишем еще один маршрут.**
```
path('post/<int:post_id>/', show_post, name='post'), #Посты
```
**Теперь наши посты будут открываться по маршруту ```post/```, Дальше указываться идентификатор этого маршрута ```<int:post_id>/```, Ну а имя марщрута будет называтся ```=post```**

***Обычно в реальных проектах, вместо ```<int:post_id>/```, используется slug ```'post/<slug:slug>/'```, ***

## Зачем нужен slug:
1. ***Читаемые URL: Slug делает URL понятным для пользователей и поисковых систем. Например, вместо example.com/post/123 вы получаете example.com/post/my-first-post.***

2. ***SEO: URL с ключевыми словами (как в slug) лучше индексируются поисковыми системами.***

3. ***Идентификатор записи: Slug можно использовать как уникальный идентификатор вместо числового id.***

**Теперь нам нужно определить нашу функцию ```show_post```, в файле ```views.py```,**

```
def show_post(request, post_id):
    return HttpResponse(f"Отображение статьи с id = {post_id}")
```
**И осталось в шаблоне ```index.html```, прописать правильно ссылки ```"#"```. Тут есть два распространенных варианта как это сделать**

## Способ 1
*  **```"{% url 'post' p.pk %}"```, Тут так же воспльзуемся тегом ```url```, прописать имя ссылки ```post```, и далее указать необходимый параметр ```p.pk```, вспоминаем - ```pk``` это идетификатор записи, потому что ```p```, это переменная цикла экземпляра класса модели ```People```. Мы  эту ```p``` используем в цикле тут же в шаблоне ```{% for p in posts %}```, кторая берется из файла ```views.py``` в функции ```index```, в этой функции мы ее и перебераем. И у этого класса есть атрибут ```pk```, котоый по умочанию в джанго используется как идентификатор записи, и мы его используем в нашем шаблоне ```index.html``` в строке ```"{% url 'post' p.pk %}"``` атрибут ```pk``` чтобы передать этот идентификатор как параметр ссылки ```post```. И теперь url возмет адрес по иени ```post```, в шаблоне ```urls.py```, а именно адрес из стрки ```path('post/<int:post_id>/', ...``` и вместо ```post_id``` подставит идентификатор записи и будет сформированна соответсвующая ссылка. Вот так вот можно создовать динамические ссылки на наши посты. Теперь коглда читать пост это такой адрес http://127.0.0.1:8000/post/1/, теперь когда мы откроем базу данных и увмдем что Анджелина Джоли соответсвует идентификатору 1. Именно этот идентификотор единицу мы в адресе и видем. А если мы возьмем другой пост допустим следующий у него уже будет идентификатор 2.** 

## Способ 2

* **Так же формируются диномические ссылки связанные сконкретными записями в базе данных. И в первом способе есть один недостаток. Если формат нашего адреса ```post``` изменится допустим, в файле ```urls.py```, в нашей строке ```path('post/<int:post_id>/', ...``` будем выводить посты не по ```id``` записи а по ```slug```, тогда, в файле ```index.html```, мы тоже должны изменить пораметр. Тут уже будет не ```pk``` а ```slug```. И именно такой вариант ```"{% url 'post' p.pk %}"```, это не очень удобно. Потому что такие динамические адресса можно формировать в разных местах в разных шаблонв и где то забудем поменять и сайт будет работать не полноценно. Будем учится формировать динамические адреса которые будут связанны с записями базы данных. И как мы уже поняли ```p``` - это ссылка на экземпляр класса People. Значит мы можем в этом классе прописать метод, допустим**
* ```
    def get_absolute_url(self):
        return reverse("post", kwargs={"post_id": self.pk})
  ```
* **Он будет формировать нужный нам маршрут к конкретной записи ```self```, это ссылка на экземпляр класса класса ```People()```, Имея эту ссылку мы можем брать любой атрибут текущей записи. В данном случае мы возьмем атрибут ```pk```. И с помощью функции ```reverse``` Функции Django, будем формировать маршрут с именем ```post``` как у нас в файле ```urls.py```. Для этого мы дополнительно передаем параметр в нашу функцию ```'post_id'```, с идентификатором текущей записи ```name='post'```. Этот идентификатор будет подствлен в маршрутизатор ```urls.py``` и после будет формироватся нужная нам ссылка. И эта ссылка будет фозвращатся в функцию ```get_absolute_url```. Теперь ипортируем функцию ```reverse```. И теперь мы можем использовать этот метод, в шаблоне ```index.html```. В место такой записи ```"{% url 'post' p.pk %}"```, запишем ее переменную а не как тег ```{{ p.get_absolute_url }}```. Сохранили и теперь посмотрим как это все отработает у нас. Теперь ссылки на посты у нас формируется с помощью функции ```get_absolute_url```, которую мы прописали в модели. Она будет теперь вызыватся для каждой записи. И такой подходи считается более предпочтительнее, чем прописывать его так ```"{% url 'post' p.pk %}"``` (Но это только тогда когда наши ссылки связаны с записями базы данных) Если они идут как самостоятельные как например, в файле ```base.html```, в меню ```<ul id="mainmenu" class="mainmenu">``` а это не элемент базы данных то тогда используем тег url - ```"{% url 'post' p.pk %}"```.  Но когда у нас отображается элементы именно записей из базы данных то лучше конечно определить такой метод ```get_absolute_url```, в модели ```People()```, И его уже использовать в шаблонах. И второй важный момент связанный с функцией заключается в том что согласно с конвенцией - модули djamgo используют вот этот метод ```get_absolute_url``` в своей работе, если он определен в модели. НАпример стандартная админ панель обращается к этому методу для построение ссылок  на каждую запись наших моделей. И в дальнейшем мы увидим как это работает.**













