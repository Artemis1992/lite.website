## Начинаем работу с админ-панелью Django

**Админ-панель поставляется сразу «из коробки» и доступна для нашего сайта. Давайте разберемся, как начать с ней работать и адаптировать ее под наши нужды.**

1. **Запускаем тестовый веб-сервер
Для этого в терминале вводим команду:**
```
python manage.py runserver
```
**Открываем админ-панель**

2. **Переходим в браузер и набираем строку:**

    ***http://127.0.0.1:8000/admin***

**Здесь перед нами откроется админ-панель. Однако, по умолчанию интерфейс будет отображаться на английском языке.**

***Русифицируем админ-панель.***

3. **Для этого откроем файл конфигурации ```settings.py```, расположенный в папке вашего проекта ```coolsite```. Найдите переменную ```LANGUAGE_CODE```, которая по умолчанию имеет значение ```'en-us'```. Измените ее на:**

```
LANGUAGE_CODE = 'ru'
```
**Сохраните изменения и обновите страницу в браузере. Теперь админка будет отображаться на русском языке.**

****
### Возможности админ-панели

**Админ-панель позволяет выполнять все основные задачи, необходимые для работы с сайтом. Вот некоторые из них:**

* **Создание и управление пользователями.**

    **Вы можете создавать пользователей с различными правами и ролями: администратор, редактор, модератор и другие.**

* **Управление приложениями.**
    
    **Админ-панель отображает все установленные приложения вашего проекта, что упрощает добавление, удаление и редактирование записей.**

* **Редактирование данных.**
    
    **Админка позволяет работать с записями в базах данных, поддерживая функции добавления, удаления и изменения.**

* **Широкая универсальность.**
    
    **Встроенная панель подходит для большинства сайтов. Это делает разработку собственной админ-панели зачастую избыточной.**

****

***Использование встроенной админ-панели в Django позволяет быстро и эффективно решать типовые задачи, экономя время и усилия разработчиков.***

## Создание суперпользователя для входа в админ-панель

**Для входа в админ-панель необходимы логин и пароль, однако на данный момент у нас нет зарегистрированных пользователей. Поэтому первым шагом будет создание суперпользователя — администратора сайта.**

1. **Возвращаемся в проект.**
    
    **Открываем терминал и переходим в каталог проекта (если вы еще не в нем)**

2. **Выполняем команду для создания суперпользователя:**
```
python manage.py createsuperuser
```
3. ## Заполняем данные:
**После выполнения команды система попросит указать следующие данные:**

* **Имя пользователя (```username```) — можно оставить поле пустым, и система автоматически установит его равным вашей учетной записи компьютера.**

* **Электронная почта (```email```) — это поле желательно заполнить для последующей связи.**

* **Пароль (```password```) — вводим надежный пароль. Обратите внимание: при вводе пароль не отображается (для безопасности).**

4. ### Подтверждаем создание.
**Если все данные введены корректно, система сообщит, что суперпользователь успешно создан.**

**Теперь у вас есть логин и пароль, с которыми можно зайти в админ-панель. Возвращаемся в браузер, вводим адрес:**

```
http://127.0.0.1:8000/admin
```
**Входим в админку.**


### Регистрация приложения в админ-панели

**После входа в админ-панель вы заметите, что в списке зарегистрированных приложений присутствуют только Группы и Пользователи. Это базовые модели, с которыми можно работать: создавать пользователей, назначать им роли, формировать группы.**

**Однако наше приложение ```People``` пока отсутствует в админке. Для его добавления необходимо зарегистрировать модель приложения.**

1. **Открываем файл ```admin.py```**
   
    **В папке вашего приложения ```people``` есть файл ```admin.py```. Именно здесь прописывается регистрация модели.**

2. **Импортируем модель.
    
    **Чтобы зарегистрировать модель ```People``` в админке, она должна быть доступна в файле ```admin.py```. Для этого добавляем импорт:**
```
from .models import *
```
1. ## Регистрируем модель.
    **Для регистрации модели People добавляем следующую строку:**
    ```
    admin.site.register(People)

    ```
    ***Здесь:***

    * **```admin``` — пакет, который отвечает за админ-панель.**
    
    * **```site``` — объект, предоставляющий интерфейс для работы с админкой.**
    * **```register``` — функция, которая связывает указанную модель с админ-панелью.**
    * **```People``` — имя модели, которую мы хотим зарегистрировать.**
2. ### Сохраняем изменения и обновляем сервер.
**После внесения изменений сохраняем файл и перезапускаем сервер, если он работает.**

**Теперь модель ```People``` появится в админ-панели.**

### Проверка работы админки и модели

**Сохраняем изменения, переходим в админку, обновляем страницу, и видим, что модель ***People*** успешно добавлена. Теперь мы можем работать с ней: добавлять, редактировать и удалять записи.**

**Также появилась кнопка "Смотреть на сайте". При нажатии на нее формируется адрес вида:**
http://127.0.0.1:8000/post/5/

**Здесь срабатывает функция-заглушка, которая отображает строку:"Отображение статьи с id = 5".**

***Как админ-панель генерирует такую кнопку?***
**Она использует метод модели ```def get_absolute_url(self):```, который определен в файле ```models.py```. Именно благодаря этому методу админка знает, какой URL должен вести к конкретной записи, и добавляет соответствующую кнопку.**

## Настройка админ-панели для модели ```People```
**Теперь улучшим отображение модели ```People``` в админ-панели, чтобы она выглядела более привлекательно и функционально.**

1. ### Изменение названия модели
**Для этого переходим в файл ```models.py``` и добавляем в класс ```People``` вложенный класс ```Meta```. В нем указываем атрибут ```verbose_name```, который отвечает за отображение имени модели в единственном числе:**
```
class Meta:
    verbose_name = 'знаменитость'
```
**После сохранения изменений в админке название модели изменится с ```People``` на Известные женщины. Однако Django автоматически добавляет букву ```'s'``` для множественного числа. Чтобы исправить это, добавляем еще один атрибут:**
```
class Meta:
    verbose_name = 'Знаменитость'
    verbose_name_plural = 'Знаменитости'
```
**Теперь название корректно отображается и в единственном, и в множественном числе.**
****
2. **Настройка сортировки записей**

    **Для удобства работы с данными добавим сортировку по времени создания и названию. В том же классе ```Meta``` укажем атрибут ```ordering:```**
```
class Meta:
    verbose_name = 'Знаменитость'
    verbose_name_plural = 'Знаменитости'
    ordering = ['time_create', 'title']
```
* **```time_create``` — сортировка по времени создания записи.**

* **```title``` — используется для дополнительной сортировки, если значения времени совпадают.**

**Если требуется обратный порядок сортировки, перед именем поля ставим знак минус:**
```
ordering = ['-time_create', 'title']
```
3. ### Проверка изменений
   1. **Сохраняем изменения в файле ```models.py```.**

   2. **Обновляем страницу админ-панели.**

   3. **Видим, что:**
        * **Название модели изменилось на Знаменитости.**
        * **Записи автоматически отсортировались по указанным правилам.**

**Теперь админка стала более удобной для работы с моделью People!**

## Изменение заголовка в админ-панели и улучшение отображения записей

1. **Изменение заголовка приложения в админке**

**Чтобы заголовок в админ-панели отображался как "Люди", откроем файл ```apps.py``` и в классе ```PeopleConfig``` добавим атрибут ```verbose_name:```**
```
class PeopleConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'people'
    verbose_name = "Люди"
```
***Объяснение:***
1. **Класс ```PeopleConfig``` отвечает за конфигурацию приложения ```people```.**

2. **Атрибут ```verbose_name``` задает альтернативное название приложения, которое будет отображаться в админ-панели.**

3. **Регистрация в ```settings.py```: Чтобы изменения применились, приложение должно быть зарегистрировано в настройках проекта через класс конфигурации:**
```
INSTALLED_APPS = [
    ...
    'women.apps.PeopleConfig',
]
```
**Если вы зарегистрируете приложение как просто ```'people'```, то ```verbose_name``` не будет применен, и заголовок в админ-панели останется стандартным.**
***

## Настройка отображения списка статей в админ-панели

**Теперь добавим дополнительные поля в список статей, чтобы отображались заголовок, время добавления, изображение и флаг публикации. Для этого откройте файл ```admin.py``` и настройте вспомогательный класс:**
```
class PeopleAdmin(admin.ModelAdmin):
    list_display = ('1d', 'title', 'time_create', 'photo', 'is_published')
    list_display_links = ('id', 'title')
    search_fields = ('title', 'content')
```
***Объяснение:***
1. ***Класс ```PeopleAdmin:```***
   * **Наследуется от ```admin.ModelAdmin``` и позволяет настроить внешний вид списка записей в админ-панели.**

2. ***Атрибуты класса:***
   * **```list_display:``` указывает список полей, которые будут отображаться в таблице. В данном случае:**
        * **```id``` — идентификатор записи.**
        * **```title``` — заголовок статьи.**
        * **```time_create``` — время создания статьи.**
        * **```photo``` — изображение статьи.**
        * **```is_published``` — флаг публикации.**
* **```list_display_links:``` определяет, по каким полям можно кликнуть, чтобы перейти к редактированию записи.**

* **```search_fields:``` задает поля, по которым можно производить поиск. Здесь поиск будет работать по заголовку (```title```) и содержимому (```content```).**

***
### Итоговый результат
1. **В админ-панели заголовок приложения отображается как "Люди".**

2. **В списке статей видны поля:**
    * **ID.**
    * **Заголовок.**
    * **Время добавления.**
    * **Изображение.**
    * **Флаг публикации.**

**Поиск статей возможен по заголовку и содержимому.**

***Теперь этот класс при регистрации нужно указать вторым параметром:***

```
admin.site.register(People, PeopleAdmin)
```
**Первым идет модель, вторым — вспомогательный класс.**

**Переходим в браузер и обновляем админ-панель. У нас появилась поисковая строка в категории Знаменитости. Мы можем искать по заголовку и контенту. Поля, которые мы хотели, теперь отображаются.**

**В классе PeopleAdmin могут быть и другие атрибуты. Их список можно изучить самостоятельно в документации Django.**

**Ну и давайте сделаем так, чтобы поля ```title``` (Заголовок), ```Time create``` (Время публикации), ```photo``` (Фото), ```is published``` (Опубликовано) выглядели так, как мы хотим.**

**Переходим в проект, открываем файл ```models.py``` и указываем в классе People для каждого поля параметр ```verbose_name="Заголовок"```. Значение этого параметра используется админ-панелью для отображения соответствующего поля.**

***И так можно поменять для каждого поля:***

```
class People(models.Model):
    title = models.CharField(max_length=255, verbose_name="Заголовок")
    content = models.TextField(blank=True, verbose_name="Контент")
    photo = models.ImageField(upload_to='photos/%Y/%m/%d/', verbose_name="Фото")
    time_create = models.DateTimeField(auto_now_add=True, verbose_name="Время создания")
    time_update = models.DateTimeField(auto_now=True, verbose_name="Время изменения")
    is_published = models.BooleanField(default=True, verbose_name="Публикация")
    cat = models.ForeignKey('Category', on_delete=models.PROTECT, null=True, verbose_name="Категория")g
```

**Теперь, когда вернемся в админ-панель, мы можем увидеть, что изменения вступили в силу.**

**Давайте зарегистрируем вторую нашу модель — категории (```Category```).**

**Переходим в проект, открываем файл ```admin.py``` и прописываем второй вспомогательный класс ```CategoryAdmin:```**
```
class CategoryAdmin(admin.ModelAdmin):
    list_display = ('id', 'name')
    list_display_links = ('id', 'name')
    search_fields = ('name',)
```
**Наш класс наследуется от того же класса ModelAdmin. У него будут пока что три атрибута:**

* **```list_display:``` поля, которые будут отображаться в списке — ```id и name```.** 
* **```list_display_links:``` поля, по которым можно кликнуть, чтобы перейти к редактированию записи — ```id``` и ```name```.**
* **```search_fields:``` поля, по которым можно будет осуществлять поиск — в данном случае это поле ```name```.**

***Обратим внимание:***

* **В параметре ```search_fields = ('name',)``` в конце обязательно нужно поставить запятую, так как здесь передается кортеж.**
  
* **Если не поставить запятую, будет передаваться строка в круглых скобках, что вызовет ошибку.**
  
* **Если бы было два элемента, запятую можно было бы не ставить.**

***Следующей строчкой регистрируем модель категории в файле ```admin.py```:***
```
admin.site.register(Category, CategoryAdmin)
```
**После регистрации ```CategoryAdmin``` необходимо русифицировать названия.**

**Для этого переходим в файл ```models.py``` и прописываем в классе ```Category``` вложенный класс ```Meta:```**
```
class Meta:
    verbose_name = 'Категория'  # Название модели в единственном числе.
    verbose_name_plural = 'Категории'  # Название модели во множественном числе.
    ordering = ['id']  # Сортировка записей по ID.
```
**Теперь изменим поле ```name``` в модели ```Category``` и зададим для него параметр ```verbose_name```, чтобы в админке оно отображалось как "Название".**
```
class Category(models.Model):
    name = models.CharField(
        max_length=100, 
        db_index=True, 
        verbose_name="Название"
    )
```

## *После изменений в мета-описании модели желательно обновить таблицы в базе данных.*
* ***Создаем файл миграции:**
```
python manage.py makemigrations
```
**Будет создана новая миграция, например, со значением ```003```.
Применяем эту миграцию:**
```
python manage.py migrate
```
**Теперь наши изменения успешно внесены в базу данных!**

# *ВСЕ! АДМИНКА НАСТРОЕНА...*

**Давайте с ее помощью добавим новые записи в категорию "Певицы".**

1. ***Переходим в раздел "Знаменитости".***
   
2. ***Нажимаем "Добавить запись".***
   
3. ***Заполняем все необходимые поля.***
   
4. ***Загружаем фото, нажав на "Выберите файл", и добавляем его.***
   
5. ***Нажимаем "Сохранить" и переходим в проект.***

***
**Загрузив фото, мы видим, что оно было помещено в папку ```media```. За это отвечает фреймворк Django: он автоматически обработал и сохранил фото. Нам не пришлось прописывать путь вручную.**

***

**Теперь добавим это фото в шаблон ```index.html```. Перед заголовком поместим следующие строки:**
```
</div>

{% if p.photo %}								   
	<p><img class="img-article-left thumb" src="{{ p.photo.url }}"></p>
{% endif %}									   

<h2>{{ p.title }}</h2>
```
***Что здесь происходит:***

* **```{% if p.photo %}```: Проверяем, существует ли поле ```photo``` (т.е. не является ли оно пустым).**
* **Если поле заполнено, то отображаем фотографию с помощью специального атрибута ```url```.**
* **Мы обращаемся к атрибуту ```photo``` и берем у него атрибут ```url```, чтобы получить ссылку на изображение.**
***
**Переходим на страницу, обновляем, и видим, что новая запись с фото добавлена.**

**Заходим в раздел "Певицы" и убеждаемся, что запись действительно появилась.**

***
**Теперь улучшим админку, чтобы поле "Публикация" стало редактируемым прямо в списке статей.**

1.  **В файле ```admin.py```, в классе ```PeopleAdmin```, добавляем следующий атрибут:**
    ```
    list_editable = ('is_published',)
    ```
    ***Что это делает:***
    * **Поля, указанные в ```list_editable```, становятся редактируемыми прямо в списке статей.**
    * **В данном случае редактируемым станет поле ```"is_published"``` (опубликовано/не опубликовано).**
2. **Возвращаемся в админку, обновляем, и теперь можем отмечать статьи как опубликованные или не опубликованные прямо в списке.**

***

**Добавим возможность фильтрации списка статей по определенным полям.**
1. **В том же классе ```PeopleAdmin``` добавим следующий атрибут:**
    ```
    list_filter = ('is_published', 'time_create')
    ```
    ***Что это делает:***
    * **Поля, указанные в ```list_filter```, используются для фильтрации записей.**
    * **В данном случае фильтрация будет по полям ***"is_published"*** (опубликовано) и ***"time_create"*** (дата создания).**
2. **Возвращаемся в админку, обновляем, и видим, что в правой части страницы появился сайдбар для фильтрации записей.**







