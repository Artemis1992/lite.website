# Регистрация пользователей

**Затрагиваем тему регистрации пользователей на сайте. На многих сайтах пользователи могут пройти регистрацию через специальную форму для получения доступа к дополнительному функционалу, например, для того чтобы оставлять комментарии, иметь личный кабинет или пользоваться другими возможностями. Разберемся, как это реализуется с помощью фреймворка Django.**

**Если мы собираемся использовать стандартную таблицу ```auth_user``` в базе данных SQLite, которая служит для хранения информации о зарегистрированных пользователях, то нам доступны следующие поля. Мы можем увидеть их в админ-панели в разделе "Пользователи", если нажмем на пользователя "root". Там будут отображаться все поля, которые мы можем использовать. Эти поля могут быть запрашиваемы у пользователя при регистрации.**

**Теперь добавим ссылку для регистрации пользователей на нашем сайте. Она будет отображаться рядом с кнопкой "Войти". Для этого:**

1. **Переходим в шаблон ```base.html```.**
2. **Находим место, где отображается главное меню с помощью цикла ```{% for %}```.**
3. **В блоке ```{% else %}``` (где отображается кнопка "Войти"), добавим ссылку для регистрации, а строку ```<li></li>``` удалим.**

```
{% else %}
    <li class="last"><a href="{% url m.url_name %}">{{m.title}}</a></li>
```
**Условия в данном цикле нам не нужны. Теперь под ```{% endfor %}``` помещаем строчку:**
```
<a href="{% url 'register' %}">Регистрация</a> | <a href='{% url 'login' %}'>Войти</a>
```
**В целом код будет выглядеть так:**
```
{% for m in menu %}
    <li><a href="{% url m.url_name %}">{{m.title}}</a></li>
{% endfor %}    
<a href="{% url 'register' %}">Регистрация</a> | <a href='{% url 'login' %}'>Войти</a>
```
**Тут прописываем конкретные URL-адреса для регистрации и входа. Мы тут формируем URL-адрес через имя маршрута ```{% url 'login' %}``` и ```{% url 'register' %}```. И, соответственно, в главном меню, где он у нас формируется в файле ```utils.py```:**
```
menu = [
    {"title": "О сайте", "url_name": "about"},
    {"title": "Добавить статью", "url_name": "add_page"},
    {"title": "Обратная связь", "url_name": "contact"},
    {"title": "Войти", "url_name": "login"},
]
```
**Мы последний пункт сейчас уберем там, где "Войти":**
```
{"title": "Войти", "url_name": "login"},
```
**И чтобы кнопка регистрации работала, нам нужно прописать маршрут ```register```. Данный маршрут мы пропишем в файле ```urls.py```:**

```

...
path('post/<slug:post_slug>/', ShowPost.as_view(), name='post'), # Посты
path('category/<slug:cat_slug>/', PeopleCategory.as_view(), name='category'), # Маршрут для отображения постов определённой категории
path('register/', login, name='register'),
]
```
**Обновляем, переходим на сайт и видим, что у нас появилось и отобразилось в таком виде:**
```
Регистрация | Войти
```
**Где-то что-то мы забыли. Переходим в шаблон и смотрим. Пункт ```<li class='last'>…</li>``` забыли прописать, в нем должна находиться наша строчка под ````{% endfor %}```:**
```
{% endfor %}    
<li class='last'><a href="{% url 'register' %}">Регистрация</a> | <a href='{% url 'login' %}'>Войти</a></li>
```
**Теперь переходим на сайт, обновляем, и данный пункт отобразился как надо. Теперь, если нажмем на "Регистрация" или "Войти", то перейдём на страницу с текстом. Пока что у нас тут ничего нет. И эта страница ведет на функцию-обработчик с простым текстом.**

**Теперь переходим в файл ```urls.py``` и в маршруте, который мы прописали, изменим login на класс ```RegisterUser.as_view()```.**
```
path('register/', RegisterUser.as_view(), name='register'),
```
**Его теперь будем использовать как класс-представление. И теперь мы его пропишем в ```views.py```. В данном классе также будут атрибуты.**
```
class RegisterUser(DataMixin, CreateView):
    form_class = UserCreationForm
    template_name = 'people/register.html'
    success_url = reverse_lazy('login')

    def get_context_data(self, *, object_list=None, **kwargs):
        context = super().get_context_data(**kwargs)
        c_def = self.get_context_data(title='Регистрация')
        return dict(list(context.items() + list(c_def.items())))
```
**Опиши форму.**

**Также надо импортировать наш класс:**
```
from django.contrib.auth.forms import UserCreationForm
```
**Теперь нам нужно создать файл ```register.html``` в папке ```templates\people```. В нем пропишем следующее:**
```
{% extends 'people/base.html' %}

{% block content %}
<h1>{{title}}</h1>

<form method='post'>
    {% csrf_token %}
    {{ form.as_p }}
    <button type='submit'>Регистрация</button>
</form>

{% endblock %}
```
**Тут, как обычно, мы расширяем базовый шаблон ```{% extends 'people/base.html' %}```. Далее отображается заголовок первого уровня ```<h1>{{title}}</h1>``` и форма.**

**У этой формы нет атрибута ```action=""```, потому что перенаправление будем делать на ту же форму в случае, если пользователь введёт что-то не так. Обработчиком нашей страницы будет эта же форма.**

**Тут также присутствует обязательный ```{% csrf_token %}```, который защищает от CSRF-атак. Выводим форму методом ```as_p```, затем кнопка регистрации.**

**Переходим на сайт и проверяем, как у нас отработает всё. Нажимаем на "Регистрация" – всё заработало. Тут у нас имя пользователя, пароль и повтор пароля.**

**Нужно улучшить внешний вид этой формы. Для этого создадим класс формы в файле ```forms.py```. Тут у нас уже есть один из классов ```AddPostForm```, сюда мы добавим ещё один класс. Пропишем его ниже, он будет называться ```RegisterUserForm```.**
```
class RegisterUserForm(UserCreationForm):
    class Meta:
        model = User
        fields = ('username', 'password1', 'password2')
        widgets = {
            'username': forms.TextInput(attrs={'class': 'form-input'}),
            'passpord1': forms.PasswordInput(attrs={'class': 'form-input'}),
            'password2': forms.PasswordInput(attrs={'class': 'form-input'}),
        }
```
**В этом коде создаётся форма регистрации пользователя в Django на основе стандартной формы ```UserCreationForm```. Разберём её по частям:**

1. **Определение класса ```RegisterUserForm```**
    ```class RegisterUserForm(UserCreationForm):```

   * **Этот класс наследуется от ```UserCreationForm```, который уже содержит поля для создания пользователя (имя пользователя, пароль и подтверждение пароля).**
  
   * **Это означает, что ```RegisterUserForm``` будет использовать логику проверки паролей, встроенную в ```UserCreationForm```.**

2. **Вложенный класс ```Meta```**

    * **```Meta``` задаёт параметры формы.**
  
    * **```model = User``` — форма будет работать с моделью ```User``` (стандартная модель пользователей в Django).**
    
    * **```fields = ('username', 'password1', 'password2')``` — указываются поля, которые будут отображаться в форме:**
        * **```username``` — имя пользователя.**
        
        * **```password1``` — первый пароль (основной).**
        
        * **```password2``` — повторный пароль (для проверки совпадения).**

3. **Определение ```widgets``` (настройка внешнего вида полей)**

    * **```widgets``` позволяет задать кастомные атрибуты HTML-элементов формы.**

    * **```'username'```: ```forms.TextInput(attrs={'class': 'form-input'})``` — делает поле ```username``` текстовым и добавляет CSS-класс ```form-input```.**

    * **```'password1'```: ```forms.PasswordInput(attrs={'class': 'form-input'})``` — делает поле пароля скрытым (типа password).**
    
    * **```'password2'```: ```forms.PasswordInput(attrs={'class': 'form-input'})``` — аналогично для второго пароля.**

**Итак, откуда мы знаем названия этих полей ```username```, ```password1```, ```password2```? Какие-то ещё имена могут быть тут?**

**Если мы перейдём в админ-панель там, где отображаются все эти поля (пользователи → добавить), то, просматривая конкретный элемент на сайте (правой кнопкой → "посмотреть код"), увидим следующее:**

```
<input type="text" name="username" class="vTextField" maxlength="150" autocapitalize="none" autocomplete="username" autofocus="" required="" aria-describedby="id_username_helptext" id="id_username"> 

<input type="password" name="password1" autocomplete="new-password" aria-describedby="id_password1_helptext" id="id_password1"> 

<input type="password" name="password2" autocomplete="new-password" aria-describedby="id_password2_helptext" id="id_password2"> 
```

**Отсюда и взяли мы имена, чтобы к ним обратиться. Вот как легко можно посмотреть имена полей и в проекте их прописать.**

**Итак, посмотрим, как это всё будет работать. Мы создали в файле ```forms.py``` ```RegisterUserForm```, также в файле ```views.py``` в классе представления ```RegisterUser``` мы должны её использовать.**

**Изменим строчку**
```
form_class = UserCreationForm  
```
***на***
```
form_class = RegisterUserForm  
```
**Соответственно, стандартную форму можем убрать, она нам не нужна.**

```
from django.contrib.auth.forms import UserCreationForm
```
**И посмотрим, как наша форма заработает. Переходим на сайт и проверяем…**

**Стили были применены, но не полностью. Вообще, в Django поле ```widgets``` в файле ```forms.py``` не работает подобным образом.**

```
widgets = {  # Кастомизируем отображение полей
    'username': forms.TextInput(attrs={'class': 'form-input'}),  # Поле ввода с CSS-классом
    'password1': forms.PasswordInput(attrs={'class': 'form-input'}),  # Поле пароля (скрытый ввод)
    'password2': forms.PasswordInput(attrs={'class': 'form-input'}),  # Повторный ввод пароля
}
```

## Поэтому мы это сделаем по-другому 

```
class RegisterUserForm(UserCreationForm):  # Наследуем форму регистрации Django
    username = forms.CharField(label='Логин', widget=forms.TextInput(attrs={'class': 'form-input'}))
    password1 = forms.CharField(label='Пароль', widget=forms.PasswordInput(attrs={'class': 'form-input'}))
    password2 = forms.CharField(label='Повтор пароля', widget=forms.PasswordInput(attrs={'class': 'form-input'}))
```
**Что происходит в коде:**
    
* **Поля формы:**
    
    * **```username``` — поле для ввода логина.**
    
    * **```password1``` — поле для ввода пароля.**

    * **```password2``` — поле для подтверждения пароля.**

* **Параметры формы:**

* **В каждом поле задается атрибут ```widget```, который позволяет указать HTML-элементы для отображения поля (в данном случае, текстовое поле для username и поле для ввода пароля для ```password1``` и ```password2```).**

* **Атрибут ```attrs={'class': 'form-input'}``` задает CSS-класс для всех полей, что позволяет применять единый стиль ко всем элементам ввода на странице.**

## добавляем стили к уже имеющимся у нас

```
/* Центрирование формы */
.form-container {
    display: flex; /* Использование flexbox для выравнивания */
    justify-content: center; /* Центрирование по горизонтали */
    align-items: flex-start; /* Выравнивание по верхнему краю по вертикали */
    min-height: 100vh; /* Минимальная высота 100% от высоты окна */
    text-align: center; /* Центрирование текста внутри */
    padding-top: 70px; /* Отступ сверху */
    overflow: hidden; /* Скрытие переполнения */
    width: 100%; /* Занимает всю ширину экрана */
}

/* Формирование формы */
form {
    width: 100%; /* Форма растягивается на всю доступную ширину */
    max-width: 500px; /* Ограничение максимальной ширины формы */
    padding: 20px; /* Внутренний отступ для элементов формы */
    background-color: #f9f9f9; /* Светлый фон */
    border-radius: 8px; /* Скругленные углы */
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* Тень вокруг формы */
    box-sizing: border-box; /* Учитываем паддинги в общем размере */
}

/* Стили для полей ввода */
.form-field input, .form-field select, .form-field textarea {
    width: 100%; /* Поля занимают всю доступную ширину */
    padding: 0.7rem; /* Отступы внутри полей */
    border: 1px solid #ccc; /* Тонкая граница */
    border-radius: 4px; /* Скругленные углы */
    font-size: 1rem; /* Размер шрифта */
    margin-bottom: 1rem; /* Отступ снизу */
    box-sizing: border-box; /* Учитываем паддинги в общем размере */
    height: 20px; /* Одинаковая высота для всех полей */
}

/* Формирование кнопки */
.submit-btn {
    padding: 0.7rem 1.5rem; /* Паддинги для кнопки */
    background-color: #4a6057; /* Зеленоватый фон */
    color: white; /* Белый текст */
    border: none; /* Без рамки */
    border-radius: 4px; /* Скругленные углы */
    cursor: pointer; /* Курсор в виде руки при наведении */
    margin-top: 1rem; /* Отступ сверху */
    display: inline-block; /* Отображение как блочный элемент */
    margin-left: auto; /* Центрирование по горизонтали */
    margin-right: auto; /* Центрирование по горизонтали */
}

/* Кнопка при наведении */
.submit-btn:hover {
    background-color: #7da392; /* Изменение фона при наведении */
}

/* Отключенная кнопка */
.submit-btn:disabled {
    background-color: #ccc; /* Серый фон */
    cursor: not-allowed; /* Курсор в виде запрета */
}

/* Стили для заголовков и ошибок */
.center-title {
    text-align: center; /* Центрирование заголовка */
    font-size: 2rem; /* Размер шрифта */
    margin-bottom: 1rem; /* Отступ снизу */
}

.form-error {
    color: red; /* Красный цвет текста */
    font-size: 0.9rem; /* Меньший размер шрифта */
    font-style: italic; /* Курсивный стиль */
    margin-top: 0.5rem; /* Отступ сверху */
}

.error-message {
    margin: 0; /* Убираем отступы */
}

/* Стили для плейсхолдеров */
.form-field input::placeholder, .form-field select::placeholder, .form-field textarea::placeholder {
    color: #aaa; /* Серый цвет плейсхолдера */
    font-style: italic; /* Курсивный стиль */
}

/* Когда пользователь кликает или фокусируется на поле, текст плейсхолдера исчезает */
.form-field input:focus::placeholder, .form-field select:focus::placeholder, .form-field textarea:focus::placeholder {
    color: transparent; /* Плейсхолдер исчезает при фокусе */
}

/* Стиль при фокусе на поле */
.form-field input:focus, .form-field select:focus, .form-field textarea:focus {
    border-color: #4CAF50; /* Зеленая граница при фокусе */
    outline: none; /* Убираем стандартный контур */
}

/* Скрываем метки на форме */
.form-label {
    display: none; /* Скрываем все метки */
}

/* Контейнер для поля пароля */
.password-container {
    position: relative; /* Относительное позиционирование для вложенных элементов */
    width: 100%; /* Поле занимает всю ширину */
}

/* Стили для кнопки отображения пароля (такого же размера, как поле ввода) */
.show-password-container {
    position: absolute; /* Абсолютное позиционирование относительно родителя */
    right: 0px; /* Отступ справа */
    top: 35.3%; /* Позиционирование по вертикали */
    transform: translateY(-49%); /* Корректировка вертикальной позиции */
    display: flex; /* Используем flex для центрирования содержимого */
    align-items: center; /* Вертикальное выравнивание содержимого */
    justify-content: center; /* Горизонтальное выравнивание */
    width: 10.7%; /* Ширина кнопки */
    height: 27.5%; /* Высота кнопки */
    font-size: 15px; /* Размер шрифта */
    cursor: pointer; /* Курсор в виде руки */
    color: #555; /* Цвет текста */
    background-color: #4a6057; /* Зеленый фон */
    padding: 0.7rem 1rem; /* Внутренние отступы */
    padding-left: 0.3rem; /* Отступ слева для сдвига текста */
    border-radius: 5px; /* Скругленные углы */
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* Тень */
    transition: background-color 0.3s; /* Плавный переход цвета */
    user-select: none; /* Отключаем выделение текста */
    text-align: center; /* Центрирование текста */
}

/* Цвет кнопки при наведении */
.show-password-container:hover {
    background-color: #7da392; /* Светлый зеленый цвет при наведении */
}

/* Стиль для текста внутри кнопки */
.show-password-container label {
    color: white; /* Белый цвет текста */
    cursor: pointer; /* Курсор в виде руки */
    margin-left: -5px; /* Сдвиг текста влево */
    padding-left: 0; /* Очищаем отступы */
}

/* Скрытие чекбокса */
.password-container input[type="checkbox"] {
    display: none; /* Скрытие чекбокса */
}

/* Стили для поля ввода пароля */
.password-container input {
    padding-right: 50px; /* Увеличиваем правый отступ для размещения кнопки */
    height: 40px; /* Высота поля ввода */
}

```

## Вывод формы в шаблоне (```register.html```)

```
{% extends 'people/base.html' %}

{% block content %}
    <h1 class="center-title">{{ title }}</h1>

    <div class="form-container">
        <form method="post" autocomplete="off">
            {% csrf_token %}

            {% for f in form %}
                <div class="form-group">
                    <label class="form-label" for="{{ f.id_for_label }}">
                        {% if f.name == 'username' %}
                            Login:
                        {% elif f.name == 'password1' %}
                            Password:
                        {% elif f.name == 'password2' %}
                            Повторите пароль:
                        {% else %}
                            {{ f.label }}
                        {% endif %}
                    </label>

                    <div class="form-field password-container">
                        <input type="{% if f.name in 'password1 password2' %}password{% else %}text{% endif %}" 
                               name="{{ f.name }}" id="{{ f.id_for_label }}" class="form-field-input"
                               autocomplete="new-password"
                               placeholder="{% if f.name == 'username' %}Введите login{% elif f.name == 'password1' %}Введите password{% elif f.name == 'password2' %}Введите повторите пароль{% else %}{{ f.label }}{% endif %}" />

                        {% if f.name in 'password1 password2' %}
                            <!-- Чекбокс для показа пароля -->
                            <div class="show-password-container">
                                <label class="clickable-label">
                                    <input type="checkbox" class="show-password" onclick="togglePassword(this)">
                                    Показать&#8203;пароль&#8203;
                                </label>
                            </div>
                        {% endif %}
                    </div>

                    {% if f.errors %}
                        <div class="form-error">
                            {% for error in f.errors %}
                                <p class="error-message">{{ error }}</p>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
            {% endfor %}

            <button type="submit" class="submit-btn">Регистрация</button>
        </form>
    </div>

    <script>
        function togglePassword(checkbox) {
            let input = checkbox.closest('.password-container').querySelector('.form-field-input');
            if (input) {
                input.type = (input.type === "password") ? "text" : "password";
            }
        }

        // Очистка полей при загрузке страницы
        window.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.form-field-input').forEach(input => {
                input.value = '';
            });
        });
    </script>

{% endblock %}
```
**Описание кода**
### 1. Наследование от базового шаблона
```
{% extends 'people/base.html' %}
```

* **Это строка указывает, что данный шаблон наследует от базового шаблона ```base.html```. Все содержимое из ```base.html``` будет загружено, и внутри блока ```content``` будет добавлено содержимое этого шаблона.**

### 2. Блок content
```
{% block content %}
    <h1 class="center-title">{{ title }}</h1>
```

* **Здесь создается блок с заголовком, который выводит значение переменной ```title```. Это значение будет передано из представления Django.**

### 3. Контейнер формы
```
<div class="form-container">
    <form method="post" autocomplete="off">
        {% csrf_token %}
```

* **Этот блок содержит форму для отправки данных. Используется метод ```POST``` для передачи данных, а также активируется защита от CSRF-атак с помощью тега ```{% csrf_token %}```.**

### 4. Цикл по полям формы
```
{% for f in form %}
    <div class="form-group">
        <label class="form-label" for="{{ f.id_for_label }}">
            {% if f.name == 'username' %}
                Login:
            {% elif f.name == 'password1' %}
                Password:
            {% elif f.name == 'password2' %}
                Повторите пароль:
            {% else %}
                {{ f.label }}
            {% endif %}
        </label>
```

* **Цикл ```{% for f in form %}``` перебирает все поля формы. Для каждого поля создается метка (```label```), которая отображает имя поля. Если это поле ```username```, то будет отображаться ```"Login"```, для пароля — ```"Password"``` и "Повторите пароль" для второго поля пароля. Для остальных полей будет выводиться имя поля, заданное в модели формы**

### 5. Поля ввода

```
<div class="form-field password-container">
    <input type="{% if f.name in 'password1 password2' %}password{% else %}text{% endif %}"
           name="{{ f.name }}" id="{{ f.id_for_label }}" class="form-field-input"
           autocomplete="new-password"
           placeholder="{% if f.name == 'username' %}Введите login{% elif f.name == 'password1' %}Введите password{% elif f.name == 'password2' %}Введите повторите пароль{% else %}{{ f.label }}{% endif %}" />
```

* **Здесь отображаются поля ввода, которые получают разные типы в зависимости от имени поля: для паролей это ```password```, для остальных полей — ```text```. Плейсхолдеры также меняются в зависимости от поля, выводя подсказки, такие как "Введите login" или "Введите пароль".**

### 6. Чекбокс для показа пароля

```
{% if f.name in 'password1 password2' %}
    <div class="show-password-container">
        <label class="clickable-label">
            <input type="checkbox" class="show-password" onclick="togglePassword(this)">
            Показать&#8203;пароль&#8203;
        </label>
    </div>
{% endif %}
```

* **Для полей с паролем добавляется чекбокс, который позволяет показывать или скрывать введенные пароли. Когда пользователь отмечает чекбокс, вызывается функция ```togglePassword()```, чтобы изменить тип поля на ```text``` или обратно на ```password```.**

### 7. Отображение ошибок

```
{% if f.errors %}
    <div class="form-error">
        {% for error in f.errors %}
            <p class="error-message">{{ error }}</p>
        {% endfor %}
    </div>
{% endif %}
```

* **Если у поля есть ошибки (например, неправильный формат или обязательное поле не заполнено), эти ошибки выводятся под соответствующим полем ввода.**

### 8. Кнопка отправки формы
```
<button type="submit" class="submit-btn">Регистрация</button>
```

* **Кнопка отправки формы с текстом "Регистрация".**

### 9. JavaScript

```
function togglePassword(checkbox) {
    let input = checkbox.closest('.password-container').querySelector('.form-field-input');
    if (input) {
        input.type = (input.type === "password") ? "text" : "password";
    }
}

window.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.form-field-input').forEach(input => {
        input.value = '';
    });
});
```

* **Функция ```togglePassword``` позволяет переключать видимость пароля: если поле пароля скрыто, оно становится видимым, и наоборот.**

* **Вторая часть ```JavaScript``` очищает все поля ввода формы при загрузке страницы.**

### 10. Закрытие блока content

```
{% endblock %}
```
* **Завершение блока контента в шаблоне, определенного в базовом шаблоне ```base.html```.**



## Они же и применятся и для Добавления статьи что так же мы исправим в шаблоне addpage.html удалим весь код и добавим новый.

```
{% extends 'people/base.html' %}  {# Наследуем базовый шаблон #}

{% block content %}
    <!-- Центрируем заголовок страницы -->
    <h1 class="center-title">{{ title }}</h1>

    <div class="form-container">
        <form method="post" enctype="multipart/form-data">  {# Форма для ввода данных с возможностью загрузки файлов #}
            {% csrf_token %}  {# Токен безопасности CSRF #}
            
            {% for f in form %}  {# Перебираем все поля формы #}
                <div class="form-group">
                    <label class="form-label" for="{{ f.id_for_label }}">
                        {# Указываем подписи для определённых полей формы #}
                        {% if f.name == 'title' %}
                            Заголовок:
                        {% elif f.name == 'content' %}
                            Контент:
                        {% elif f.name == 'photo' %}
                            Изображение:
                        {% elif f.name == 'slug' %}
                            Слаг:
                        {% elif f.name == 'cat' %}
                            Категория:
                        {% else %}
                            {{ f.label }}  {# Для остальных полей используем стандартную метку #}
                        {% endif %}
                    </label>
                    <div class="form-field">
                        <!-- Определяем вид ввода для каждого типа данных -->
                        {% if f.name == 'title' %}
                            <input type="text" name="{{ f.name }}" id="{{ f.id_for_label }}" 
                                   class="form-field-input" placeholder="Введите заголовок"
                                   value="{{ f.value|default:'' }}" />  {# Заполняем, если есть предыдущее значение #}
                            
                        {% elif f.name == 'content' %}
                            <textarea name="{{ f.name }}" id="{{ f.id_for_label }}" 
                                      class="form-field-input" placeholder="Введите контент">
                                {{ f.value|default:'' }}
                            </textarea>
                        {% elif f.name == 'slug' %}
                            <input type="text" name="{{ f.name }}" id="{{ f.id_for_label }}" 
                                   class="form-field-input" placeholder="Введите слаг"
                                   value="{{ f.value|default:'' }}" />
                        {% elif f.name == 'photo' %}
                            <input type="file" name="{{ f.name }}" id="{{ f.id_for_label }}" />
                        {% elif f.name == 'cat' %}
                            <select name="{{ f.name }}" id="{{ f.id_for_label }}">
                                <option value="">Выберите категорию</option>
                                {% for choice in f.field.choices %}
                                    <option value="{{ choice.0 }}" {% if choice.0 == f.value %}selected{% endif %}>
                                        {{ choice.1 }}
                                    </option>
                                {% endfor %}
                            </select>
                        {% else %}
                            {{ f }}  {# Выводим остальные поля формы как есть #}
                        {% endif %}
                    </div>
                    {% if f.errors %}  {# Если есть ошибки валидации, выводим их #}
                        <div class="form-error">
                            {% for error in f.errors %}
                                <p class="error-message">{{ error }}</p>  
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
            {% endfor %}
            
            <button type="submit" class="submit-btn">Добавить</button>  {# Кнопка отправки формы #}
        </form>
    </div>
{% endblock %}

```
### Объяснение кода addpage.html

**1. Наследование базового шаблона**
```
{% extends 'people/base.html' %}
```
**Этот тег Django означает, что текущий шаблон наследуется от ```people/base.html```, который содержит общий каркас страницы (например, заголовок, подвал, стили).**
***
**2. Определение блока контента**
```
{% block content %}
```
**Тег ```{% block content %}``` обозначает, что далее идёт содержимое, которое вставится в соответствующий блок ```content``` базового шаблона.**

***
**3. Заголовок страницы**
```
<h1 class="center-title">{{ title }}</h1>
```
**Переменная ```{{ title }}``` подставляется в заголовок. Её значение передаётся из представления ```(views.py)```.**

**Класс ```center-title``` отвечает за центрирование заголовка.**
***
**4. Создание формы**
```
<div class="form-container">
    <form method="post" enctype="multipart/form-data">
```
* **```<div class="form-container">``` – контейнер для стилизации формы.**

* **```<form method="post" enctype="multipart/form-data">```**

    * **```method="post"``` – отправка формы через POST-запрос (не через GET, так как передаются данные).**

    * **```enctype="multipart/form-data"``` – необходимо, если форма содержит загрузку файлов.**
***

**5. Токен CSRF**
```
{% csrf_token %}
```
**Django требует включать этот токен для защиты от межсайтовых атак (CSRF). Он создаёт уникальный код, проверяющий подлинность отправки формы.**

***
**6. Перебор полей формы**

```
{% for f in form %}
```
**Этот цикл перебирает все поля формы ```form```, переданной из представления.**

***
**7. Контейнер для каждого поля**

```
<div class="form-group">
```
**Каждое поле формы оборачивается в ```<div class="form-group">```, что помогает правильно оформить поля с помощью CSS.**

***
**8. Вывод подписи (```label```) к полям**
```
<label class="form-label" for="{{ f.id_for_label }}">
```
**```<label>``` – элемент, привязанный к конкретному полю формы (```for="{{ f.id_for_label }}"```).**

**```{{ f.id_for_label }}``` – идентификатор текущего поля формы.**

***
**9. Кастомизированные названия полей**
```
{% if f.name == 'title' %}
    Заголовок:
{% elif f.name == 'content' %}
    Контент:
{% elif f.name == 'photo' %}
    Изображение:
{% elif f.name == 'slug' %}
    Слаг:
{% elif f.name == 'cat' %}
    Категория:
{% else %}
    {{ f.label }}
{% endif %}
```
**В зависимости от имени поля (```f.name```) мы присваиваем ему русскоязычное название:**

* **```title``` → Заголовок**
* **```content``` → Контент**
* **```photo``` → Изображение**
* **```slug``` → Слаг (URL-идентификатор статьи)**
* **```cat``` → Категория**
    
    **Если поле не попадает под эти условия, используется его стандартная метка ```{{ f.label }}```.**

***
**Поле "Контент" (многострочное)**
```
{% elif f.name == 'content' %}
    <textarea name="{{ f.name }}" id="{{ f.id_for_label }}" 
              class="form-field-input" placeholder="Введите контент">
        {{ f.value|default:'' }}
    </textarea>
```

* **```<textarea>``` – используется для ввода длинного текста.**

* **```{{ f.value|default:'' }}``` – подставляет введённое ранее значение (если есть).**
***

**Поле "Слаг"**

```
{% elif f.name == 'slug' %}
    <input type="text" name="{{ f.name }}" id="{{ f.id_for_label }}" 
           class="form-field-input" placeholder="Введите слаг"
           value="{{ f.value|default:'' }}" />
```
* **Обычное текстовое поле, но для slug (URL-пути статьи).**

***
**Поле "Фото" (файл)**

```
{% elif f.name == 'photo' %}
    <input type="file" name="{{ f.name }}" id="{{ f.id_for_label }}" />
```
**```<input type="file">``` – поле загрузки изображения.**

***
**Поле "Категория" (выпадающий список)**
```
{% elif f.name == 'cat' %}
    <select name="{{ f.name }}" id="{{ f.id_for_label }}">
        <option value="">Выберите категорию</option>
        {% for choice in f.field.choices %}
            <option value="{{ choice.0 }}" {% if choice.0 == f.value %}selected{% endif %}>
                {{ choice.1 }}
            </option>
        {% endfor %}
    </select>
```

* **```<select>``` – выпадающий список.**

* **Варианты (```<option>```) подставляются из ```f.field.choices``` (списка категорий).**

* **```selected``` применяется, если текущий вариант совпадает с уже выбранным.**
***
**Поля без кастомизации**
```
{% else %}
    {{ f }}
```
**Если поле не требует особого оформления, оно вставляется в шаблон без изменений.**

***
**11. Вывод ошибок валидации**
```
{% if f.errors %}
    <div class="form-error">
        {% for error in f.errors %}
            <p class="error-message">{{ error }}</p>  
        {% endfor %}
    </div>
{% endif %}
```
* **Если в поле есть ошибки (f.errors), они отображаются внутри ```<div class="form-error">```.**
* **Каждый текст ошибки (```error```) выводится в ```<p class="error-message">```.**

***
**12. Кнопка отправки формы**

```
<button type="submit" class="submit-btn">Добавить</button>
```
* **```<button type="submit">``` – отправляет форму.**

* **```class="submit-btn"``` – для стилизации кнопки.**

***
**13. Закрытие блока контента**
```
{% endblock %}
```
**Закрывает ранее открытый ```{% block content %}```, завершая формирование страницы.**

# Итог

**Этот шаблон ```addpage.html```:**

* **Наследует ```people/base.html```.**

* **Создаёт форму с полями (текст, файл, список).**

* **Присваивает каждому полю понятную подпись.**

* **Проверяет и выводит ошибки валидации.**

* **Добавляет кнопку "Добавить" для отправки формы.**


## И вернёмся к регистрации нового пользователя. Попробуем зарегистрировать его.

* User1
* 123456
* 123456

**Если всё сделали правильно, то перейдём на страницу авторизации. Что и правильно, потому что в классе представления ```RegisterUser``` указали ```success_url``` и далее указали перейти на логин:**

```
success_url = reverse_lazy('login')
```
**— что он и сделал. Соответственно, можно попробовать ввести что-нибудь неверное при регистрации, и нам будут выдавать сообщения: «Пользователь с таким именем уже существует», «Введённые пароли не совпадают» и т.д., и наша форма в таком базовом варианте уже работает. Добавим в наше поле ещё и email.**

**Для этого в файле ```forms.py```, где формируется класс ```RegisterUserForm```, мы пропишем строку для поля email:**
```
email = forms.EmailField(label='Email', widget=forms.EmailInput(attrs={'class': 'form-input'}))
```

**И, кроме того, мы должны в списке полей ниже указать его в поле ```fields```:**
```
fields = ('username', 'email', 'password1', 'password2')
```

**У нас всё сформировано, и блок``` widgets``` можно убрать — он теперь нам не нужен.**
```
widgets = {  # Кастомизируем отображение полей
    'username': forms.TextInput(attrs={'class': 'form-input'}),  # Поле ввода с CSS-классом
    'password1': forms.PasswordInput(attrs={'class': 'form-input'}),  # Поле пароля (скрытый ввод)
    'password2': forms.PasswordInput(attrs={'class': 'form-input'}),  # Повторный ввод пароля
}
```
**Переходим на страницу и обновляем её, и у нас появляется поле email. Попробуем зарегистрироваться и перейдём в админку, чтобы посмотреть наших пользователей. У нас появились два пользователя: один без электронной почты, а другой с ней.**







